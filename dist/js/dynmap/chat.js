componentconstructors.chat=function(e,t){if(!e.getBoolParameterByName("hidechat")){$(e).bind("worldupdate",function(t,a){swtch(a.type,{chat:function(){$(e).trigger("chat",[{source:a.source,name:a.playerName,text:a.message,account:a.account,channel:a.channel}])}})});var a=null;t.allowurlname&&(a=e.getParameterByName("chatname"),""==a&&(a=null)),e.options.allowwebchat&&$(e).bind("sendchat",function(t,n){var r='{"name":'+JSON.stringify(a?a:"")+',"message":'+JSON.stringify(n)+"}";$.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:config.url.sendmessage,data:r,dataType:"json",success:function(t){if("none"!=t.error){var a=e.options["msg-chatnotallowed"];$(e).trigger("chat",[{source:"me",name:"Error",text:a}])}},error:function(t){403===t.status&&$(e).trigger("chat",[{source:"me",name:"Error",text:e.options.spammessage.replace("%interval%",e.options["webchat-interval"])}])}})})}};
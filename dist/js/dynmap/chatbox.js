componentconstructors.chatbox=function(e,a){if(!e.getBoolParameterByName("hidechat")){var s=$("<div/>").addClass("chat").appendTo(e.options.container),n=$("<div/>").addClass("messagelist").appendTo(s);if(a.visiblelines?n.css("max-height",a.visiblelines+"em"):n.css("max-height","6em"),a.scrollback&&n.addClass("scrollback").click(function(){$(this).hide()}),e.options.allowwebchat)if(e.options.loggedin||!e.options["webchat-requires-login"]){var t=$("<input/>").addClass("chatinput").attr({id:"chatinput",type:"text",value:"",maxlength:e.options.chatlengthlimit}).keydown(function(a){"13"==a.keyCode&&(a.preventDefault(),""!=t.val()&&($(e).trigger("sendchat",[t.val()]),t.val("")))});if(a.sendbutton){$("<button/>").addClass("chatsendbutton").click(function(a){""!=t.val()&&($(e).trigger("sendchat",[t.val()]),t.val(""))}).text("+").appendTo(s)}t.appendTo(s),a.scrollback&&t.click(function(){var e=$(".messagelist");e.show().scrollTop(e.scrollHeight())})}else{$("<button/>").addClass("loginbutton").click(function(e){window.location="login.html"}).text(e.options["msg-chatrequireslogin"]).appendTo(s)}var o=function(e){if(a.scrollback){var s=n.children();s.slice(0,Math.max(0,s.length-a.scrollback)).each(function(e,a){$(a).remove()})}else setTimeout(function(){e.remove()},1e3*a.messagettl);n.append(e),n.show(),n.scrollTop(n.scrollHeight())};$(e).bind("playerjoin",function(a,s){e.options.joinmessage.length>0&&s.length>0?o($("<div/>").addClass("messagerow").append(e.options.joinmessage.replace("%playername%",s))):e.options["msg-hiddennamejoin"].length>0&&0==s.length&&o($("<div/>").addClass("messagerow").append(e.options["msg-hiddennamejoin"]))}),$(e).bind("playerquit",function(a,s){e.options.quitmessage.length>0&&s.length>0?o($("<div/>").addClass("messagerow").append(e.options.quitmessage.replace("%playername%",s))):e.options["msg-hiddennamequit"].length>0&&0==s.length&&o($("<div/>").addClass("messagerow").append(e.options["msg-hiddennamequit"]))}),$(e).bind("chat",function(s,n){var t=(n.name,n.account),i=$("<div/>").addClass("messagerow"),l=$("<span/>").addClass("messageicon");"player"===n.source&&a.showplayerfaces&&t&&getMinecraftHead(t,16,function(e){i.icon=$(e).addClass("playerMessageIcon").appendTo(l)});var d="";if(n.channel&&(d=$("<span/>").addClass("messagetext").text("["+n.channel+"] ").appendTo(i)),"player"===n.source&&a.showworld&&t){$("<span/>").addClass("messagetext").text("["+e.players[t].location.world.name+"]").appendTo(i)}var c="";n.name&&(c=$("<span/>").addClass("messagetext").append(" "+n.name+": "));var p=$("<span/>").addClass("messagetext").text(chat_encoder(n));i.append(l,d,c,p),o(i)})}};
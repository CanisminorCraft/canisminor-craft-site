L.CustomMarker=L.Class.extend({includes:L.Mixin.Events,options:{contentCreator:void 0,shadowCreator:void 0,clickable:!0,draggable:!1},initialize:function(t,e){L.Util.setOptions(this,e),this._latlng=t},onAdd:function(t){this._map=t,!this._element&&this.options.elementCreator&&(this._element=this.options.elementCreator(),this._element.className+=" leaflet-marker-icon",this._initInteraction()),!this._shadow&&this.options.shadowCreator&&(this._shadow=this.options.shadowCreator()),this._element&&t._panes.markerPane.appendChild(this._element),this._shadow&&t._panes.shadowPane.appendChild(this._shadow),t.on("viewreset",this._reset,this),this._reset()},onRemove:function(t){this._element&&t._panes.markerPane.removeChild(this._element),this._shadow&&t._panes.shadowPane.removeChild(this._elementShadow),t.off("viewreset",this._reset,this),t=null},getLatLng:function(){return this._latlng},setLatLng:function(t){this._latlng=t,this._reset()},_reset:function(){if(null!=this._map){var t=this._map.latLngToLayerPoint(this._latlng);this._element&&L.DomUtil.setPosition(this._element,t),this._shadow&&L.DomUtil.setPosition(this._shadow,t),this._element&&(this._element.style.zIndex=t.y)}},_initInteraction:function(){if(this._element&&this.options.clickable){this._element.className+=" leaflet-clickable",L.DomEvent.addListener(this._element,"click",this._onMouseClick,this);for(var t=["dblclick","mousedown","mouseover","mouseout"],e=0;e<t.length;e++)L.DomEvent.addListener(this._element,t[e],this._fireMouseEvent,this)}this._element&&L.Handler.MarkerDrag&&(this.dragging=new L.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())},_onMouseClick:function(t){L.DomEvent.stopPropagation(t),this.dragging&&this.dragging.moved()||this.fire(t.type)},_fireMouseEvent:function(t){this.fire(t.type),L.DomEvent.stopPropagation(t)},openPopup:function(){return this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup),this},closePopup:function(){this._popup&&this._popup._close()},bindPopup:function(t,e){return this._popup=new L.Popup(e),this._popup.setContent(t),this.on("click",this.openPopup,this),this}});
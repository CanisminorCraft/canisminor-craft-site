function loadjs(t,i){var e=document.createElement("script");e.setAttribute("src",t),e.setAttribute("type","text/javascript");var n=!1;e.onload=function(){n||(n=!0,i())},e.onreadystatechange=function(){"loaded"!=e.readyState&&"complete"!=e.readyState||e.onload()},(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}function loadcss(t,i){var e=document.createElement("link");e.setAttribute("href",t),e.setAttribute("rel","stylesheet");var n=!1;i&&(e.onload=function(){n||(n=!0,i())},e.onreadystatechange=function(){e.onload()}),(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}function splitArgs(t){var i=t.split(" ");delete arguments[0];var e={};return $.each(arguments,function(t,n){if(t){var o=i[t-1];e[n]=o}}),e}function swtch(t,i,e){return(i[t]||e||function(){})(t)}function Location(t,i,e,n){this.world=t,this.x=i,this.y=e,this.z=n}function namedReplace(t,i){for(var e=0,n="";;){var o=t.indexOf("{",e),s=t.indexOf("}",o+1);if(o<0||s<0){n+=t.substr(e);break}if(o<s){var a=t.substring(o+1,s);n+=t.substring(e,o),n+=i[a]}else n+=t.substring(e,o-1),n+="";e=s+1}return n}var DynmapProjection=L.Class.extend({initialize:function(t){L.Util.setOptions(this,t)},fromLocationToLatLng:function(t){throw"fromLocationToLatLng not implemented"},fromLatLngToLocation:function(t){return null}});Array.prototype.indexOf||(Array.prototype.indexOf=function(t){"use strict";if(void 0===this||null===this)throw new TypeError;var i=Object(this),e=i.length>>>0;if(0===e)return-1;var n=0;if(arguments.length>0&&(n=Number(arguments[1]),n!==n?n=0:0!==n&&n!==1/0&&n!==-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=e)return-1;for(var o=n>=0?n:Math.max(e-Math.abs(n),0);o<e;o++)if(o in i&&i[o]===t)return o;return-1});var DynmapLayerControl=L.Control.Layers.extend({getPosition:function(){return"topleft"}}),DynmapTileLayer=L.TileLayer.extend({_currentzoom:void 0,getProjection:function(){return this.projection},onTileUpdated:function(t,i){var e=this.dynmap.getTileUrl(i);t.attr("src",e),t.show()},getTileName:function(t,i){throw"getTileName not implemented"},getTileUrl:function(t,i){var e=this.getTileName(t,i),n=this._cachedTileUrls[e];return n||(this._cachedTileUrls[e]=n=this.options.dynmap.getTileUrl(e)),n},updateNamedTile:function(t){var i=this._namedTiles[t];delete this._cachedTileUrls[t],i&&this.updateTile(i)},updateTile:function(t){this._loadTile(t,t.tilePoint,this._map.getZoom())},_addTilesFromCenterOut:function(t){if(null!=this._container){for(var i=[],e=t.getCenter(),n=t.min.y;n<=t.max.y;n++)for(var o=t.min.x;o<=t.max.x;o++)o+":"+n in this._tiles||i.push(new L.Point(o,n));i.sort(function(t,i){return t.distanceTo(e)-i.distanceTo(e)});var s=document.createDocumentFragment();this._tilesToLoad=i.length;for(var a=0,r=this._tilesToLoad;a<r;a++)this._addTile(i[a],s);this._container.appendChild(s)}},_addTile:function(t,i){var e=this._getTilePos(t),n=this._map.getZoom(),o=t.x+":"+t.y,s=this.getTileName(t,n),a=1<<n;if(!this.options.continuousWorld){if(this.options.noWrap){if(t.x<0||t.x>=a)return void this._tilesToLoad--}else t.x=(t.x%a+a)%a;if(t.y<0||t.y>=a)return void this._tilesToLoad--}var r=this._createTile();r.tileName=s,r.tilePoint=t,L.DomUtil.setPosition(r,e),this._tiles[o]=r,this._namedTiles[s]=r,"tms"==this.options.scheme&&(t.y=a-t.y-1),this._loadTile(r,t,n),i.appendChild(r)},_loadTile:function(t,i,e){function n(){o._loadingTiles.splice(o._loadingTiles.indexOf(t),1),o._nextLoadTile()}var o=this;t._layer=this,t.onload=function(t){o._tileOnLoad.apply(this,[t]),n()},t.onerror=function(){o._tileOnError.apply(this),n()},t.loadSrc=function(){o._loadingTiles.push(t),t.src=o.getTileUrl(i,e)},this._loadQueue.push(t),this._nextLoadTile()},_nextLoadTile:function(){if(!(this._loadingTiles.length>4)){var t=this._loadQueue.shift();t&&t.loadSrc()}},_removeOtherTiles:function(t){var i,e,n,o;for(o in this._tiles)if(this._tiles.hasOwnProperty(o)&&(i=o.split(":"),e=parseInt(i[0],10),n=parseInt(i[1],10),e<t.min.x||e>t.max.x||n<t.min.y||n>t.max.y)){var s=this._tiles[o];s.parentNode===this._container&&this._container.removeChild(this._tiles[o]),delete this._namedTiles[s.tileName],delete this._tiles[o]}},_updateTileSize:function(){var t=this._map.getZoom();if(this._currentzoom!==t){var i=this.calculateTileSize(t);this._currentzoom=t,i!==this.options.tileSize&&this.setTileSize(i)}},_reset:function(){this._updateTileSize(),this._tiles={},this._namedTiles={},this._loadQueue=[],this._loadingTiles=[],this._cachedTileUrls={},this._initContainer(),this._container.innerHTML=""},_update:function(){this._updateTileSize();var t=this._map.getPixelBounds(),i=this.options.tileSize,e=new L.Point(Math.floor(t.min.x/i),Math.floor(t.min.y/i)),n=new L.Point(Math.floor(t.max.x/i),Math.floor(t.max.y/i)),o=new L.Bounds(e,n);this._addTilesFromCenterOut(o),this.options.unloadInvisibleTiles&&this._removeOtherTiles(o)},calculateTileSize:function(t){var i=this.options.maxZoom-t,e=Math.max(0,this.options.mapzoomin-i);return 128<<e},setTileSize:function(t){this.options.tileSize=t,this._tiles={},this._createTileProto()},updateTileSize:function(t){},zoomprefix:function(t){return"zzzzzzzzzzzzzzzzzzzzzz".substr(0,t)},getTileInfo:function(t,i){var e=this.options.maxZoom-i,n=Math.max(0,e-this.options.mapzoomin),o=1<<n,s=o*t.x,a=o*t.y;return{prefix:this.options.prefix,nightday:this.options.nightandday&&this.options.dynmap.serverday?"_day":"",scaledx:s>>5,scaledy:a>>5,zoom:this.zoomprefix(n),zoomprefix:0==n?"":this.zoomprefix(n)+"_",x:s,y:a,fmt:this.options["image-format"]||"png"}}});!function(t){t.fn.scrollHeight=function(t){return this[0].scrollHeight}}($);
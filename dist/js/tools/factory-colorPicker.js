!function(e){var o,r,c,t=0,n={control:e('<div class="colorPicker-picker">&nbsp;</div>'),palette:e('<div id="colorPicker_palette" class="colorPicker-palette" />'),swatch:e('<div class="colorPicker-swatch">&nbsp;</div>'),hexLabel:e('<label for="colorPicker_hex">Hex</label>'),hexField:e('<input type="text" id="colorPicker_hex" />')},i="transparent";e.fn.colorPicker=function(o){return this.each(function(){var r,c,l=e(this),a=e.extend({},e.fn.colorPicker.defaults,o),s=e.fn.colorPicker.toHex(l.val().length>0?l.val():a.pickerDefault),d=n.control.clone(),f=n.palette.clone().attr("id","colorPicker_palette-"+t),h=n.hexLabel.clone(),F=n.hexField.clone(),u=f[0].id;if(e.each(a.colors,function(o){r=n.swatch.clone(),a.colors[o]===i?(r.addClass(i).text("X"),e.fn.colorPicker.bindPalette(F,r,i)):(r.css("background-color","#"+this),e.fn.colorPicker.bindPalette(F,r)),r.appendTo(f)}),h.attr("for","colorPicker_hex-"+t),F.attr({id:"colorPicker_hex-"+t,value:s}),F.bind("keydown",function(o){if(13===o.keyCode){var r=e.fn.colorPicker.toHex(e(this).val());e.fn.colorPicker.changeColor(r?r:l.val())}27===o.keyCode&&e.fn.colorPicker.hidePalette()}),F.bind("keyup",function(o){var r=e.fn.colorPicker.toHex(e(o.target).val());e.fn.colorPicker.previewColor(r?r:l.val())}),e('<div class="colorPicker_hexWrap" />').append(h).appendTo(f),f.find(".colorPicker_hexWrap").append(F),a.showHexField===!1&&(F.hide(),h.hide()),e("body").append(f),f.hide(),d.css("background-color",s),d.bind("click",function(){l.is(":not(:disabled)")&&e.fn.colorPicker.togglePalette(e("#"+u),e(this))}),o&&o.onColorChange?d.data("onColorChange",o.onColorChange):d.data("onColorChange",function(){}),(c=l.data("text"))&&d.html(c),l.after(d),l.bind("change",function(){l.next(".colorPicker-picker").css("background-color",e.fn.colorPicker.toHex(e(this).val()))}),l.val(s),"input"===l[0].tagName.toLowerCase())try{l.attr("type","hidden")}catch(e){l.css("visibility","hidden").css("position","absolute")}else l.hide();t++})},e.extend(!0,e.fn.colorPicker,{toHex:function(e){if(e.match(/[0-9A-F]{6}|[0-9A-F]{3}$/i))return"#"===e.charAt(0)?e:"#"+e;if(!e.match(/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/))return!1;var o=[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)],r=function(e){if(e.length<2)for(var o=0,r=2-e.length;o<r;o++)e="0"+e;return e};if(3===o.length){var c=r(o[0].toString(16)),t=r(o[1].toString(16)),n=r(o[2].toString(16));return"#"+c+t+n}},checkMouse:function(c,t){var n=r,i=e(c.target).parents("#"+n.attr("id")).length;c.target===e(n)[0]||c.target===o[0]||i>0||e.fn.colorPicker.hidePalette()},hidePalette:function(){e(document).unbind("mousedown",e.fn.colorPicker.checkMouse),e(".colorPicker-palette").hide()},showPalette:function(r){var c=o.prev("input").val();r.css({top:o.offset().top+o.outerHeight(),left:o.offset().left}),e("#color_value").val(c),r.show(),e(document).bind("mousedown",e.fn.colorPicker.checkMouse)},togglePalette:function(c,t){t&&(o=t),r=c,r.is(":visible")?e.fn.colorPicker.hidePalette():e.fn.colorPicker.showPalette(c)},changeColor:function(r){o.css("background-color",r),o.prev("input").val(r).change(),e.fn.colorPicker.hidePalette(),o.data("onColorChange").call(o,e(o).prev("input").attr("id"),r)},previewColor:function(e){o.css("background-color",e)},bindPalette:function(r,t,n){n=n?n:e.fn.colorPicker.toHex(t.css("background-color")),t.bind({click:function(o){c=n,e.fn.colorPicker.changeColor(n)},mouseover:function(o){c=r.val(),e(this).css("border-color","#598FEF"),r.val(n),e.fn.colorPicker.previewColor(n)},mouseout:function(t){e(this).css("border-color","#000"),r.val(o.css("background-color")),r.val(c),e.fn.colorPicker.previewColor(c)}})}}),e.fn.colorPicker.defaults={pickerDefault:"FFFFFF",colors:["000000","993300","333300","000080","333399","333333","800000","FF6600","808000","008000","008080","0000FF","666699","808080","FF0000","FF9900","99CC00","339966","33CCCC","3366FF","800080","999999","FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0","FF99CC","FFCC99","FFFF99","CCFFFF","99CCFF","FFFFFF"],addColors:[],showHexField:!0}}(jQuery);
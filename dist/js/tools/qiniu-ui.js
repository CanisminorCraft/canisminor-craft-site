function FileProgress(r,s){if(this.fileProgressID=r.id,this.file=r,this.opacity=100,this.height=0,this.fileProgressWrapper=$("#"+this.fileProgressID),this.fileProgressWrapper.length)this.reset();else{this.fileProgressWrapper=$("<tr></tr>");var e=this.fileProgressWrapper;e.attr("id",this.fileProgressID).addClass("progressContainer");var t=$("<td/>");t.addClass("progressImg");var a=plupload.formatSize(r.size).toUpperCase(),i=$("<td/>");i.addClass("progressName").html('<div><strong>name:</strong><span class="origin-format">'+r.name+'</span></div><div><strong>size:</strong><span class="origin-format">'+a+"</span></div>");var p=$("<td/>"),o=$("<div/>");o.addClass("info");var n=$("<div/>");n.addClass("progress progress-striped");var l=$("<div/>");l.addClass("progress-bar progress-bar-info").attr("role","progressbar").attr("aria-valuemax",100).attr("aria-valuenow",0).attr("aria-valuein",0).width("0%");var d=$("<span class=sr-only />");d.text(a);var g=$("<a href=javascript:; />");g.show().addClass("progressCancel").text("×"),l.append(d),n.append(l),o.append(n),o.append(g);var f=$('<div class="status text-center"/>');o.append(f),p.append(o),e.append(t),e.append(i),e.append(p),$("#"+s).append(e)}this.height=this.fileProgressWrapper.offset().top,this.setTimer(null)}FileProgress.prototype.setTimer=function(r){this.fileProgressWrapper.FP_TIMER=r},FileProgress.prototype.getTimer=function(r){return this.fileProgressWrapper.FP_TIMER||null},FileProgress.prototype.reset=function(){this.fileProgressWrapper.attr("class","progressContainer"),this.fileProgressWrapper.find("td .progress .progress-bar-info").attr("aria-valuenow",0).width("0%").find("span").text(""),this.appear()},FileProgress.prototype.setChunkProgess=function(r){var s=Math.ceil(this.file.size/r);if(1===s)return!1;for(var e=$('<button class="btn btn-default">查看分块上传进度</button>'),t=$('<tr class="chunk-status-tr"><td colspan=3></td></tr>'),a=$("<div/>"),i=1;i<=s;i++){var p=$('<div class="col-md-2"/>'),o=$('<div class="progress progress-striped"></div'),n=$("<div/>");n.addClass("progress-bar progress-bar-info text-left").attr("role","progressbar").attr("aria-valuemax",100).attr("aria-valuenow",0).attr("aria-valuein",0).width("0%").attr("id",this.file.id+"_"+i).text("");var l=$("<span/>");l.addClass("chunk-status").text(),o.append(n),o.append(l),p.append(o),a.append(p)}this.fileProgressWrapper.find("td:eq(2) .btn-default").length||this.fileProgressWrapper.find("td>div").append(e),t.hide().find("td").append(a),t.insertAfter(this.fileProgressWrapper)},FileProgress.prototype.setProgress=function(r,s,e){this.fileProgressWrapper.attr("class","progressContainer green");var t=this.file,a=t.loaded,i=plupload.formatSize(a).toUpperCase(),p=plupload.formatSize(s).toUpperCase(),o=this.fileProgressWrapper.find("td .progress").find(".progress-bar-info");if("取消上传"!==this.fileProgressWrapper.find(".status").text()){if(this.fileProgressWrapper.find(".status").text("已上传: "+i+" 上传速度： "+p+"/s"),r=parseInt(r,10),t.status!==plupload.DONE&&100===r&&(r=99),o.attr("aria-valuenow",r).css("width",r+"%"),e){var n=Math.ceil(t.size/e);if(1===n)return!1;for(var l,d,g=Math.ceil(a/e),f=0;f<g;f++)l=$("#"+t.id+"_"+f),l.width("100%").removeClass().addClass("alert-success").attr("aria-valuenow",100),d="块"+f+"上传进度100%",l.next().html(d);var h,c=$("#"+t.id+"_"+g);if(g<n)a%e?h=(a%e/e*100).toFixed(2):(h=100,c.removeClass().addClass("alert-success"));else{var u=t.size-e*(n-1),v=t.size-a;v%u?h=(a%e/u*100).toFixed(2):(h=100,c.removeClass().addClass("alert-success"))}c.width(h+"%"),c.attr("aria-valuenow",h),d="块"+g+"上传进度"+h+"%",c.next().html(d)}this.appear()}},FileProgress.prototype.setComplete=function(r,s){var e,t=this.fileProgressWrapper.find("td:eq(2)"),a=t.find(".progress"),i=$.parseJSON(s);if(i.url)e=i.url,str="<div><strong>Link:</strong><a href="+i.url+" target='_blank' > "+i.url+"</a></div><div><strong>Md:</strong><span>![]("+i.url+")</span></div><div><strong>CSS:</strong><span>background-image: url("+i.url+");</span></div>";else{var p=r.getOption("domain");e=p+encodeURI(i.key);var o=p+i.key;str="<div><strong>Link:</strong><a href="+e+" target='_blank' > "+o+"</a></div><div><strong>Md:</strong><span>![]("+e+")</span></div><div><strong>CSS:</strong><span class='css-value'>background-image: url("+e+");</br>background-size: 100%;</br>"}a.html(str).removeClass().next().next(".status").hide(),t.find(".progressCancel").hide();var n=this.fileProgressWrapper.find(".progressName"),l=this.fileProgressWrapper.find(".progressImg"),d="?imageView2/2/w/200",g=function(r){var s,e="",t=["png","jpg","jpeg","gif","bmp"],a=/\.([a-zA-Z0-9]+)(\?|\@|$)/;if(!r||!a.test(r))return!1;s=a.exec(r),e=s[1].toLowerCase();for(var i=0,p=t.length;i<p;i++)if(e===t[i])return!0;return!1},f=g(e),h=$('<a class="linkWrapper" target="_blank"/>'),c=$('<img class="loading" src="https://o4j4l4n7h.qnssl.com/21286c8f87655564753f7d602c31385bea7fd85f2fcf1fd06-rMeG10_fw658.gif"/>');if(l.append(h),f){h.append(c);var u=new Image;if(!/imageView/.test(e)){var v=e;e+=d}$(u).attr("src",e);$(u).on("load",function(){c.attr("src",e),h.attr("href",v).attr("title","查看原图");var r=($('<div class="infoWrapper"></div>'),Qiniu.detectIEVersion());if(!(r&&r<=9))var s=Qiniu.imageInfo(i.key),a='<div><strong>type:</strong><span class="origin-format">'+s.format+'</span></div><div><strong>width:</strong><span class="orgin-width">'+s.width+'px</span></div><div><strong>height:</strong><span class="origin-height">'+s.height+"px</span></div>",p="width: "+s.width/2+"px;</br>height: "+s.height/2+"px;";n.append(a);var o=t.find(".css-value");o.append(p)}).on("error",function(){c.attr("src","default.png")})}else c.attr("src","https://o4j4l4n7h.qnssl.com/default.png"),h.append(c)},FileProgress.prototype.setError=function(){this.fileProgressWrapper.find("td:eq(2)").attr("class","text-warning"),this.fileProgressWrapper.find("td:eq(2) .progress").css("width",0).hide(),this.fileProgressWrapper.find("button").hide(),this.fileProgressWrapper.next(".chunk-status-tr").hide()},FileProgress.prototype.setCancelled=function(r){var s="progressContainer";r||(s+=" red"),this.fileProgressWrapper.attr("class",s),this.fileProgressWrapper.find("td .progress").remove(),this.fileProgressWrapper.find("td:eq(2) .btn-default").hide(),this.fileProgressWrapper.find("td:eq(2) .progressCancel").hide()},FileProgress.prototype.setStatus=function(r,s){s||this.fileProgressWrapper.find(".status").text(r).attr("class","status text-left")},FileProgress.prototype.bindUploadCancel=function(r){var s=this;r&&s.fileProgressWrapper.find("td:eq(2) .progressCancel").on("click",function(){s.setCancelled(!1),s.setStatus("取消上传"),s.fileProgressWrapper.find(".status").css("left","0"),r.removeFile(s.file)})},FileProgress.prototype.appear=function(){if(null!==this.getTimer()&&(clearTimeout(this.getTimer()),this.setTimer(null)),this.fileProgressWrapper[0].filters)try{this.fileProgressWrapper[0].filters.item("DXImageTransform.Microsoft.Alpha").opacity=100}catch(r){this.fileProgressWrapper.css("filter","progid:DXImageTransform.Microsoft.Alpha(opacity=100)")}else this.fileProgressWrapper.css("opacity",1);this.fileProgressWrapper.css("height",""),this.height=this.fileProgressWrapper.offset().top,this.opacity=100,this.fileProgressWrapper.show()};